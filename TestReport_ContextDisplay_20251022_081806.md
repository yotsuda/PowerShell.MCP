# PowerShell.MCP v1.3.0以降のテスト結果まとめ

## 差分の確認

### 主な変更点（v1.3.0以降）

1. **Update-MatchInFile**: コンテキスト表示機能追加（grep風の出力）
   - マッチした行と前後2行のコンテキストを表示
   - 反転表示（ANSI エスケープシーケンス）を使用
   - ギャップが1行以下の場合は範囲をマージ

2. **Add-LinesToFile**: コンテキスト表示機能追加
   - 挿入した行と前後のコンテキストを表示
   - 1パス実装でパフォーマンス向上

3. **Update-LinesInFile**: コンテキスト表示機能追加
   - 更新・削除した行と前後のコンテキストを表示
   - 1パス実装でパフォーマンス向上

4. **TextFileCmdletBase**: CalculateAndMergeRanges メソッド追加
   - コンテキスト範囲の計算とマージロジック

### 新規テストの追加

新しいテストファイル: `Tests\Integration\ContextDisplay.Tests.ps1`

- Update-MatchInFile コンテキスト表示: 6テスト
- Add-LinesToFile コンテキスト表示: 4テスト  
- Update-LinesInFile コンテキスト表示: 4テスト
- ギャップマージロジック: 2テスト

**合計: 16テスト全てパス ✅**

## 全体のテスト結果

- **総テスト数**: 235
- **パス**: 206 (87.7%)
- **失敗**: 29 (12.3%)
- **スキップ**: 0

### 失敗テストの分析

失敗している29個のテストは、v1.3.0以降の新機能とは**無関係**です：

1. **空文字列による削除機能** (6テスト)
   - Update-MatchInFile で Replacement に空文字列を指定した場合の動作
   - 既存機能の問題

2. **その他の統合テスト** (23テスト)
   - 一時ファイルのアクセス権限エラー
   - パラメータ検証のテスト
   - 既存機能のエッジケース

### 結論

✅ **v1.3.0以降のコンテキスト表示機能は正常に動作しています**

新機能の全16テストがパスし、以下が確認されました：
- コンテキスト表示が正しく出力される
- 反転表示（ANSI エスケープシーケンス）が正しく適用される
- ギャップマージロジックが正しく機能する
- 3つのコマンドレット全てで機能が実装されている

失敗している29テストは既存機能の問題であり、新機能とは無関係です。
